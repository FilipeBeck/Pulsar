<!DOCTYPE HTML>
<html>
	<head>
		<title> Eu sou o index.html </title>
		<script src="../core.js"></script>
		<!--<script src="../controllers.js"></script>-->
		<script>
			Pulsar.class('MyController', Object, function($)
			{
				$('public').buttonPressed = function(sender)
				{
					alert(`${sender.innerHTML} pressed`);
				}
				
				$('public').buttonReleased = function(sender)
				{
					alert(`${sender.innerHTML} released`);
				}
				
				$('public').init = function()
				{
					
				}
			})
			
			Pulsar.class('Application', Object, function($)
			{
				$().init = function(storyboardURL)
				{ // Cena raiz
					var iFrame = document.createElement('iFrame');
					
					iFrame.src = 'application.storyboard/index.html';
					
					document.body.appendChild(iFrame);
					
					iFrame.onload = function()
					{
						iFrame.contentDocument.getElementsByAttribute = function(attr)
						{
							var nodeList = this.getElementsByTagName('*');
							var nodeArray = [];

							for (var i = 0, elem; elem = nodeList[i]; i++) {
									if ( elem.getAttribute(attr) ) nodeArray.push(elem);
							}

							return nodeArray;
						};
						
						var controller = new parent[iFrame.contentDocument.body.getAttribute('data-controller')];
						var controls = iFrame.contentDocument.getElementsByAttribute('data-class');
						
						for (var i in controls)
						{
							control = controls[i];
							
							var events = control.getAttribute('data-action').split(' ');
							
							for (var i in events)
							{
								var event = events[i].split(':');
								
								control.addEventListener(event[0], function(e) {
									controller[event[1]](e.target);
								})
							}
						}
					}
				}
			})
			
			function load()
			{
				Pulsar.class('MyClass', Object, function($)
				{
					$().init = function()
					{
						alert('JOOJJOJOJOJO');
					}
				})
				
				localStorage.setItem('oi', 'HI');
				console.log('index.localStorage', window.localStorage);
				var INDEX = 'INDEX_VAR'
				//alert(`INDEX: ${document.domain}`);
				var iframe = document.getElementsByTagName( "iframe" )[ 0 ];
				//alert( "Frame title: " + iframe.contentWindow.document.title );
				
			}
		</script>
	</head>
	<body onLoad="new Application('application.storyboard')">
	</body>
</html>